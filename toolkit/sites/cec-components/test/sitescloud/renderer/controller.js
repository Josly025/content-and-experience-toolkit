/**
 * Copyright (c) 2019 Oracle and/or its affiliates. All rights reserved.
 * Licensed under the Universal Permissive License v 1.0 as shown at http://oss.oracle.com/licenses/upl.
 */
"use strict";var SCS=window.SCS||{};SCS.sitePrefix=SCS.sitePrefix||"/",SCS.data={pageId:null,siteInfo:null,structure:null,structurePages:null,basePageModel:null,baseSlotReuseModel:null,pageModel:null,pageLayout:null,mobileLayout:null,navMap:{},navRoot:null,placeholderContent:null,startProgressTimer:null,pageTimeoutTimer:null},SCS.performance={timers:{}},SCS.xmlhttp=new XMLHttpRequest,Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.substr(t,e.length)===e}),SCS.initRendering=function(){this.data.startProgressTimer=setTimeout(this.onStartProgress,2500),this.data.pageTimeoutTimer=setTimeout(this.onPageTimeout,3e4),this.setCacheKeys(),this.processSitePrefix(),this.getSiteStructure()},SCS.getSiteLocales=function(){return this.siteLocales||window.localStorage&&window.localStorage["scs.builder.mls.locales"]&&window.localStorage["scs.builder.mls.locales"].split(",")},SCS.processSitePrefix=SCS.processSitePrefix||function(e){if(e=e||window.location.pathname,e=decodeURI(e)){e.startsWith("/mobileauthsite/")&&this.sitePrefix.startsWith("/authsite/")&&(this.sitePrefix=this.sitePrefix.replace("/authsite/","/mobileauthsite/"));var t=this.getSiteLocales();if(t){var s=e.replace(this.sitePrefix,""),r=s&&s.split("/")[0];r&&-1!==t.indexOf(r)&&(this.data.locale=r)}e.startsWith(this.sitePrefix)||e!==this.sitePrefix.substring(0,this.sitePrefix.length-1)&&(this.sitePrefix="/")}},SCS.setCacheKeys=SCS.setCacheKeys||function(e){var t={product:(e=e||window.SCSCacheKeys||{}).product||"",site:e.site||"",theme:e.theme||"",component:e.component||"",caas:e.caas||""};SCS.cacheKeys=t},SCS.onStartProgress=function(){var e=document.getElementById("scsWaitImage");e&&(e.style.display="block")},SCS.onPageTimeout=function(){SCS.clearWaitImage()},SCS.clearWaitImage=function(){var e=document.getElementById("scsWaitImage");e&&(e.style.display="none")},SCS.clearTimers=function(){null!==this.data.pageTimeoutTimer&&(window.clearTimeout(this.data.pageTimeoutTimer),this.data.pageTimeoutTimer=null),null!==this.data.startProgressTimer&&(window.clearTimeout(this.data.startProgressTimer),this.data.startProgressTimer=null)},SCS.onRenderError=function(e){this.clearTimers(),this.clearWaitImage(),this.logError(e)},SCS.logError=function(e){try{e&&window.console&&window.console.error?window.console.error(e):e&&window.console&&window.console.log&&window.console.log(e)}catch(e){}},SCS.parseJson=function(e){var t=null;try{t=JSON.parse(e)}catch(t){throw this.onRenderError("Failed to parse JSON: "+e+" Message: "+t.message),t}return t},SCS.encodeHTML=function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return e.replace(/[&"<>'\/]/g,function(e){return t[e]})},SCS.getProductUrl=function(e){var t=!1!==(e=e||{}).useCacheKeys&&SCS.cacheKeys.product?SCS.cacheKeys.product:"",s=t?"/"+SCS.cacheKeys.product:"",r=t?SCS.cacheKeys.product+"/":"",a=e.useSharedUrl?"/_sitesclouddelivery"+s:this.sitePrefix+r+"_sitesclouddelivery";return SCS.sitesCloudCDN&&"string"==typeof SCS.sitesCloudCDN&&!1!==e.useCDN&&(a=SCS.sitesCloudCDN+"/_sitesclouddelivery"),a},SCS.getPageLayout=function(e){if(e){var t=SCS.cacheKeys.theme?SCS.cacheKeys.theme+"/":"",s=SCS.sitePrefix+t+"_themesdelivery/"+encodeURIComponent(this.data.siteInfo.properties.themeName)+"/layouts/"+encodeURIComponent(e);SCS.performance.startTimer("GET layout"),this.callService(s,this.processPageLayout,this.processPageLayout)}else this.onRenderError("A page layout was not specified in the page model.")},SCS.processPageLayout=function(e,t,s){if(s=s||document,SCS.performance.stopTimer("GET layout"),!t||200!=e.status||"string"!=typeof t||t.search(/id=(["'])scsControllerBody\1/g)>=0){var r=this.getErrorPageId();this.data.isRenderingErrorPage||null===r?this.onRenderError("The page layout could not be obtained from the server."):(this.data.isRenderingErrorPage=!0,this.data.pageId=r,this.fetchPageData())}else{t=this.preFillPageLayout(t);for(var a=[{re:/(<!--\$\s*SCS_SITE_HEADER\s*-->)|(\[!--\$\s*SCS_SITE_HEADER\s*--\])/g,src:"siteInfo.properties.header"},{re:/(<!--\$\s*SCS_SITE_FOOTER\s*-->)|(\[!--\$\s*SCS_SITE_FOOTER\s*--\])/g,src:"siteInfo.properties.footer"},{re:/(<!--\$\s*SCS_PAGE_HEADER\s*-->)|(\[!--\$\s*SCS_PAGE_HEADER\s*--\])/g,src:"pageModel.properties.header"},{re:/(<!--\$\s*SCS_PAGE_FOOTER\s*-->)|(\[!--\$\s*SCS_PAGE_FOOTER\s*--\])/g,src:"pageModel.properties.footer"}],i=0;i<a.length;i++){for(var n=a[i].re,o=a[i].src.split("."),c="",l=this.data,S=0;S<o.length-1;S++){if(!l[o[S]]||"object"!=typeof l[o[S]]){l=null;break}l=l[o[S]]}l&&(c="string"==typeof l[o[o.length-1]]?l[o[o.length-1]]:""),t=t.replace(n,c)}var h=SCS.cacheKeys.theme?SCS.cacheKeys.theme+"/":"";SCS.cacheKeys.product&&SCS.cacheKeys.product;t=(t=(t=t.replace(/(["'])\/_sitescloud(\/renderer\/require\.js)/g,"$1"+this.getProductUrl({useCDN:!SCS.useSharedRequireJS&&!SCS.useOriginalRequireJS,useSharedUrl:SCS.useSharedRequireJS})+"$2")).replace(/(["'])\/_sitescloud\//g,"$1"+this.getProductUrl()+"/")).replace(/(["'])\/_themes\//g,"$1"+this.sitePrefix+h+"_themesdelivery/"),t=this.resolveLinks(t),t=this.applySlotReuseData(t);var u=this.getPageModelStyleMarkup();u&&(t=t.replace(/(\s+|>)(<\/head\s*>(?:\s+|<))/i,function(e,t,s){var r=t+u+s;return u="",r})),t=this.injectWyciwygCacheBuster(t),SCS.performance.stopTimer("CONTROLLER"),SCS.performance.startTimer("WriteLayout");var d={siteId:this.data.siteInfo&&this.data.siteInfo.properties&&this.data.siteInfo.properties.siteName?this.data.siteInfo.properties.siteName:null,sitePrefix:this.sitePrefix,pageModel:this.data.pageModel,localePageModel:this.data.localePageModel,navigationRoot:this.data.navRoot,navigationCurr:this.data.pageId&&"string"==typeof this.data.pageId?parseInt(this.data.pageId):this.data.pageId,structureMap:this.data.navMap,siteInfo:this.data.siteInfo,placeholderContent:this.data.placeholderContent,deviceInfo:SCS.getDeviceInfo(),sitesCloudCDN:"string"==typeof SCS.sitesCloudCDN&&SCS.sitesCloudCDN||"",performance:{timers:SCS.performance.timers},cacheKeys:this.cacheKeys},p=JSON.stringify(d),g="";g+='<script id="scsRenderInfo" type="application/json">',g+=this.encodeHTML(p),g+="<\/script>",g+='\n<script id="scsRenderObject" type="text/javascript">var require = {waitSeconds: 0};<\/script>',g+=u;var f=/(<!--\$\s*SCS_RENDER_INFO\s*-->)|(\[!--\$\s*SCS_RENDER_INFO\s*--\])/g;t=t.replace(f,function(){return g}),this.clearTimers(),this.clearWaitImage(),SCS={},s.open("text/html","replace"),s.write(t),s.close()}},SCS.preFillPageLayout=SCS.preFillPageLayout||function(e){var t,s,r,a,i,n,o,c,l,S,h,u=e,d=this.data.pageModel,p=this.data.localePageModel||{};if(d&&d.componentInstances){i=d.componentInstances;for(S in i)if(i.hasOwnProperty(S)&&"object"==typeof i[S]&&(n=i[S],c=p.componentInstances&&p.componentInstances[S]||{},n&&(o=n.data,l=c.data||{},a="string"==typeof n.type&&0===n.type.indexOf("scs-inline-")))){if(o&&"string"==typeof o.innerHTML){var g=l.innerHTML||o.innerHTML;s=a?"":'<div class="scs-component-bounding-box">',r=a?"":"</div>","string"==typeof(t=this.replaceTagContent(u,S,s+g+r))&&(u=t,n.preRenderedByController=!0)}(h=this.getComponentAttributes(o,l))&&"object"==typeof h&&(u=this.replaceTagAttributes(u,S,h),n.preRenderedByController=!0)}}return u},SCS.getComponentAttributes=function(e,t){var s,r,a,i={};if(e&&"object"==typeof e)for(r in e)"attr_"==r.substring(0,"attr_".length)&&(a=r.substring("attr_".length))&&(i[a]=t[r]||e[r],s=i);return s},SCS.replaceTagAttributes=function(e,t,s){var r,a,i,n,o,c,l,S,h,u=e,d="(<\\w+\\s+)[^>]*[Ii][Dd]=([\"']?)"+t+"\\2(>|[^>]*)>",p={},g="",f="";try{if(e&&t&&Object.keys(s).length>0&&(i=new RegExp(d,"g"),h=i.exec(e))){r=h.index,a=i.lastIndex,S="/"==(n=e.substring(r,a))[n.length-2],o=h[1],c=S?"/>":">",l=n.substring(o.length,n.length-c.length),p=SCS.parseTagAttributes(l);for(f in s)p[f]=s[f];g="";for(f in p)void 0===p[f]?g+=f+" ":g+=f+'="'+p[f]+'" ';u=e.substring(0,r+o.length),u+=g,u+=e.substring(r+o.length+l.length)}}catch(e){SCS.logError("Failed to replace attributes: "+e.message)}return u},SCS.parseTagAttributes=function(e){for(var t={},s="",r="",a="",i="",n=e.length,o=0,c=0;c>=0&&c<n;){for(;c<n&&" "==(a=e.charAt(c));c++);if(c==n)break;for(o=c;c<n&&(" "!=(a=e.charAt(c))&&"="!=a);c++);for(s=e.substr(o,c-o);c<n&&" "==(a=e.charAt(c));c++);if("="==a){for(c+=1;c<n&&" "==(a=e.charAt(c));c++);for("'"==a||'"'==a?(i=a,c+=1):i=" ",o=c;c<n&&(a=e.charAt(c))!=i;c++);r=e.substr(o,c-o),t[s]=r,c++}else t[s]=void 0,o=c}return t},SCS.replaceTagContent=function(e,t,s,r){var a,i,n,o,c,l=null;r=r||{};try{(c=(o=new RegExp("<(\\w+)\\s+[^>]*[Ii][Dd]=([\"']?)"+t+"\\2(>|[^>]*)>","g")).exec(e))&&(c.index,a=o.lastIndex,n=c[1],(i=this.findEndTag(e,n,a))>=0&&(l=e.substring(0,r.append?i:a),l+=s,l+=e.substring(i)))}catch(e){SCS.logError("Failed to replace content: "+e.message)}return l},SCS.findEndTag=function(e,t,s){var r,a,i,n,o=-1;try{if(r=new RegExp("</"+t+"\\s*>","gi"),r.lastIndex=s,a=r.exec(e)){o=a.index,(i=new RegExp("<"+t+"\\s*>","gi")).lastIndex=s;do{if(n=i.exec(e)){if(n.index>o)break;(a=r.exec(e))&&(o=a.index)}}while(n&&a)}}catch(e){SCS.logError("Failed to find end tag: "+e.message)}return o},SCS.injectWyciwygCacheBuster=function(e){var t,s,r=e;return"number"==typeof window.mozInnerScreenX&&(s=/<head(?:\s+[^>]*?)?>/gi.exec(e))&&s[0]&&(t=s.index+s[0].length,r=e.substr(0,t),r+='\n<script type="text/javascript">\n',r+='if( 0 === document.URL.indexOf("wyciwyg://") ) { \n',r+="window.location.replace( window.location.href ); ",r+="}\n<\/script>",r+=e.substr(t)),r},SCS.getPageModelStyleMarkup=function(){var e,t,s,r,a="";try{e=this.data.pageModel.properties.styles,a+=this.getStyleMarkup("scs-styles-body","body",e);for(s in this.data.pageModel.slots)t=this.data.pageModel.slots[s],r=this.data.pageModel.componentInstances,a+=this.getContainerStyleMarkup(s,t,r,!0)}catch(e){a=""}return a.length>0&&(a='\n<style id="scsPageStyles" type="text/css">'+a+"\n</style>"),a},SCS.getContainerStyleMarkup=function(e,t,s,r){var a,i,n,o,c,l,S="";if(t&&(a=t.styles,o=r?"scs-slot-styles-":"scs-container-styles-",c=this.encodeHTML("#"+e)+(r?"":" > .scs-container-styles > .scs-component-content"),S+=this.getStyleMarkup(o+e,c,a),t.components&&Array.isArray(t.components)))for(l=0;l<t.components.length;l++)"object"==typeof s[i=t.components[l]]&&("scs-componentgroup"!==(n=s[i]).type&&"scs-sectionlayout"!==n.type||(S+=this.getContainerStyleMarkup(i,n.data,s,!1)));return S},SCS.getStyleMarkup=function(e,t,s){var r,a,i,n,o,c="";if(Array.isArray(s)&&s.length>0){for(c+="\n"+t+" {",a=0;a<s.length;a++)"string"==typeof(r=s[a])&&(i=r.indexOf(":"))>=0&&(n=r.substring(0,i).trim(),o=r.substring(i+1).trim(),n.indexOf(">")<0&&n.indexOf("<")<0&&o.indexOf(">")<0&&o.indexOf("<")<0&&(c+="\n"+n+": "+(o=this.resolveLinks(o))+";"));c+="\n}"}return c},SCS.applySlotReuseData=function(e){var t=this.getIdentifiedSlotIds(e);return this.fixupPageModelWithSlotReuseData(t.slotIds),t.pageLayout},SCS.getIdentifiedSlotIds=function(e){var t,s,r,a,i,n,o,c=/<!--\s*SCS Layout Information:\s*(\{[\s\S]*?\})\s*-->/;if(e=e.replace(c,function(e,s){try{var r=JSON.parse(s);t=r.slotIds}catch(e){}return""}),!Array.isArray(t)&&(t=[],r=/<\w+\s+[^>]*?[Cc][Ll][Aa][Ss][Ss]\s*=\s*(['"])(?:\s*|[^>'"]*?\s+)scs-slot(?:\s*\1|\s+[^>'"]*?\1)[^>]*?>/g,s=e.match(r)))for(i=/\s+id\s*=\s*(['"])([^'">]+)\1(?:\s+|\/?>)/i,o=0;o<s.length;o++)(a=s[o].match(i))&&(n=a[2])&&t.push(n);return{pageLayout:e,slotIds:t}},SCS.fixupPageModelWithSlotReuseData=function(e){var t,s,r,a,i,n=this.data.pageModel,o=this.data.baseSlotReuseModel;if(o&&e)for(i=0;i<e.length;i++)if(t=e[i],"object"==typeof o[t]&&"object"==typeof o[t].base&&o[t].base.site&&"object"==typeof o[t].base.site&&(s=JSON.parse(JSON.stringify(o[t].base.site)),n.slots[t]=s,s.componentInstances)){for(r in s.componentInstances)a=JSON.parse(JSON.stringify(s.componentInstances[r])),n.componentInstances[r]=a;delete s.componentInstances}},SCS.callService=function(e,t,s){this.xmlhttp.onreadystatechange=function(){if(4==this.readyState){var r;if(200==this.status)r=""+this.responseText,t.call(SCS,this,r);else if(s)r=""+this.responseText,s.call(SCS,this,r);else{try{r=""+this.responseText}catch(e){}SCS.onRenderError("Status "+this.status+" returned from "+e+" with response: "+r)}}},this.xmlhttp.open("GET",e,!0),this.xmlhttp.send()},SCS.resolveLinks=function(e){var t=e;"object"==typeof e&&(t=JSON.stringify(e));var s=/(<!--\$\s*SCS_CONTENT_URL\s*-->)|(\[!--\$\s*SCS_CONTENT_URL\s*--\])/g,r=/(<!--\$\s*SCS_COMP_CATALOG_URL\s*-->)|(\[!--\$\s*SCS_COMP_CATALOG_URL\s*--\])/g,a=/(<!--\$\s*SCS_DIST_FOLDER\s*-->)|(\[!--\$\s*SCS_DIST_FOLDER\s*--\])/g,i=/(<!--\$\s*SCS_DIST_IMG_FOLDER\s*-->)|(\[!--\$\s*SCS_DIST_IMG_FOLDER\s*--\])/g,n=/(<!--\$\s*SCS_THEME_NAME\s*-->)|(\[!--\$\s*SCS_THEME_NAME\s*--\])/g,o=/(<!--\$\s*SCS_DESIGN_NAME\s*-->)|(\[!--\$\s*SCS_DESIGN_NAME\s*--\])/g,c=/(<!--\$\s*SCS_RENDERER_PATH\s*-->)|(\[!--\$\s*SCS_RENDERER_PATH\s*--\])/g,l=/(<!--\$\s*SCS_SITE_PATH\s*-->)|(\[!--\$\s*SCS_SITE_PATH\s*--\])/g,S=/\[!--\$\s*SCS_PAGE\s*--\]\s*(.*?)\s*\[\/!--\$\s*SCS_PAGE\s*--\]/g,h=/\[!--\$\s*SCS_DIGITAL_ASSET\s*--\]\s*(.*?)\s*\[\/!--\$\s*SCS_DIGITAL_ASSET\s*--\]/g,u=/\[!--\$\s*SCS_DIGITAL_ASSET_PUBLISHED\s*--\]\s*(.*?)\s*\[\/!--\$\s*SCS_DIGITAL_ASSET_PUBLISHED\s*--\]/g,d=/(_scs_theme_root_)/g,p=/(_scs_design_name_)/g,g=/\[!--\$SCS_TEL--\]*(.*?) *\[\/!--\$SCS_TEL--\]/g,f=/<!--\s*SCS View Mode:([\s\S]*?)-->/g,C=this,m=(SCS.cacheKeys.product&&SCS.cacheKeys.product,SCS.cacheKeys.site?SCS.cacheKeys.site+"/":""),y=SCS.cacheKeys.theme?SCS.cacheKeys.theme+"/":"",P=SCS.cacheKeys.component?SCS.cacheKeys.component+"/":"",I=SCS.cacheKeys.caas?"?cb="+SCS.cacheKeys.caas:"",v=C.data.siteInfo.properties.siteRootPrefix,T=(v&&v.indexOf("/authsite/"),function(e){return e.replace(/\/+$/,function(){return""})});return t=t.replace(s,function(){return SCS.sitePrefix+m+"content"}),t=t.replace(r,function(){return SCS.sitePrefix+P+"_compdelivery"}),t=t.replace(a,function(){return SCS.getProductUrl()}),t=t.replace(i,function(){return SCS.getProductUrl()+"/renderer"}),t=t.replace(c,function(){return SCS.getProductUrl()+"/renderer"}),t=t.replace(l,function(){return T(SCS.sitePrefix+m)}),t=t.replace(d,function(){return SCS.sitePrefix+y+"_themesdelivery/"+encodeURIComponent(C.data.siteInfo.properties.themeName)}),t=t.replace(p,function(){return encodeURIComponent(C.data.siteInfo.properties.designName||"default")}),t=t.replace(n,function(){return encodeURIComponent(C.data.siteInfo.properties.themeName)}),t=t.replace(o,function(){return encodeURIComponent(C.data.siteInfo.properties.designName||"default")}),t=t.replace(S,function(e,t){var s,r=SCS.getPageLinkData(t);return r&&"string"==typeof r.href&&(s=r.href),s}),t=t.replace(h,function(e,t){return"/content/published/api/v1.1/assets/"+t+"/default"+I}),t=t.replace(u,function(e,t){return"/content/published/api/v1.1/assets/"+t+"/default"+I}),t=t.replace(g,function(e,t){return"tel:"+encodeURI(t)}),t=t.replace(f,function(e,t){return t}),"object"==typeof e&&(t=JSON.parse(t)),t},SCS.getPageLinkData=function(e){var t,s,r=!1,a=null,i=this.data.navMap,n="";if(i&&("number"==typeof e||"string"==typeof e&&e)){var o=i[e];o&&("string"==typeof o.linkUrl&&o.linkUrl.trim().length>0?(t=o.linkUrl.trim(),"string"==typeof o.linkTarget&&(n=o.linkTarget.trim())):(a=o.pageUrl)&&(t=this.combineUrlSegments(this.sitePrefix,a)),r=!0===o.hideInNavigation)}return t&&(s={href:t,target:n,hideInNavigation:r}),s},SCS.combineUrlSegments=function(e,t){var s="";return"string"==typeof e&&"string"==typeof t&&e.length>0&&t.length>0&&(s="/"==e.charAt(e.length-1)&&"/"==t.charAt(0)?e+t.substring(1):"/"==e.charAt(e.length-1)&&"/"!=t.charAt(0)||"/"!=e.charAt(e.length-1)&&"/"==t.charAt(0)?e+t:e+"/"+t),s},SCS.getSiteStructure=function(){var e=SCS.cacheKeys.site?SCS.cacheKeys.site+"/":"",t=SCS.sitePrefix+e+"structure.json";SCS.performance.startTimer("GET structure.json"),this.callService(t,this.processSiteStructure)},SCS.processSiteStructure=function(e,t){SCS.performance.stopTimer("GET structure.json");var s=this.parseJson(t);this.data.structure=s;var r=s.siteInfo;r&&(this.data.siteInfo=r.base),this.produceSiteNavigationStructure()},SCS.produceSiteNavigationStructure=function(){var e=this.data.structure.base&&this.data.structure.base.pages?this.data.structure.base.pages:[];this.data.structurePages=e;for(var t=this.data.structurePages||[],s=0;s<t.length;s++){var r=t[s];this.data.navMap[r.id]=r,null==r.parentId&&(this.data.navRoot=r.id)}this.getPageData()},SCS.getSlotReuseData=function(){var e=SCS.cacheKeys.site?SCS.cacheKeys.site+"/":"",t=SCS.sitePrefix+e+"slots.json";SCS.performance.startTimer("GET slots.json"),this.callService(t,this.processSlotReuseData)},SCS.processSlotReuseData=function(e,t){SCS.performance.stopTimer("GET slots.json");try{if(!t||200!=e.status||"string"!=typeof t||t.search(/id=(["'])scsControllerBody\1/g)>=0)throw"Invalid response received while fetching slot data.";var s=this.parseJson(t);this.data.baseSlotReuseModel=this.getEffectiveSlotReuseModel(s)}catch(e){this.data.baseSlotReuseModel=null}this.getPageData()},SCS.getPageData=function(e){var t,s=0,r=null;if(e=e||window.location.pathname,e=decodeURI(e),this.data.locale&&(e=e.replace(this.sitePrefix+this.data.locale+"/","")),(e=e.replace(this.sitePrefix,""))&&e===this.sitePrefix.substring(0,this.sitePrefix.length-1)){var a=this.sitePrefix;return window.location.search&&window.location.search.length>0&&(a+=window.location.search),window.location.hash&&window.location.hash.length>0&&(a+=window.location.hash),void this.redirectToUrl(a)}for(s=0;s<this.data.structurePages.length;s++){if(e===this.data.structurePages[s].pageUrl){r=this.data.structurePages[s].id;break}t=t||!!this.data.structurePages[s].isDetailPage}if(null==r&&0==e.length&&null!=this.data.navRoot&&(r=this.data.navRoot),null===r&&t&&(r=this.getDetailPageId(e)),null==r&&null!==(r=this.getErrorPageId())&&(this.data.isRenderingErrorPage=!0),null==r)return this.logError("The page could not be found in the site structure."),void this.showErrorPage(404);this.data.pageId=r,this.fetchPageData(this.data.pageId)},SCS.getDetailPageId=function(e){var t,s,r,a,i,n,o,c=null;for(t=0;t<this.data.structurePages.length;t++)if(this.data.structurePages[t].isDetailPage&&(s=this.data.structurePages[t].pageUrl,r=s.lastIndexOf("."),a=s.lastIndexOf("/"),i=r>a?r:s.length,n=r>a?s.substring(a+1,r):s.substr(a+1),s.length>0&&e.length>s.length&&s.substr(0,i)===e.substr(0,i)&&("/"===e.charAt(i)||0===n.length)&&(o=e.substring(i+1),3===(o=o.split("/")).length&&o[0].length>0&&o[1].length>0))){c=this.data.structurePages[t].id,this.data.placeholderContent={contentType:o[0],contentId:o[1]};break}return c},SCS.fetchPageData=function(){var e=SCS.cacheKeys.site?SCS.cacheKeys.site+"/":"";SCS.performance.startTimer("GET page.json");var t;this.data.locale?(t=SCS.sitePrefix+e+"pages/"+this.data.pageId+"-"+this.data.locale+".json",this.callService(t,this.processLocalePageData,this.processLocalePageData)):(t=SCS.sitePrefix+e+"pages/"+this.data.pageId+".json",this.callService(t,this.processPageData,this.processPageData))},SCS.processLocalePageData=function(e,t){try{if(!t||200!=e.status||"string"!=typeof t||t.search(/id=(["'])scsControllerBody\1/g)>=0)throw"Invalid response received while fetching locale page data.";var s=this.parseJson(t);this.data.localePageModel=s&&s.base||s}catch(e){this.logError("Unable to retrieve page data for locale: "+this.data.locale)}var r=SCS.cacheKeys.site?SCS.cacheKeys.site+"/":"",a=SCS.sitePrefix+r+"pages/"+this.data.pageId+".json";this.callService(a,this.processPageData,this.processPageData)},SCS.processPageData=function(e,t){SCS.performance.stopTimer("GET page.json");try{if(!t||200!=e.status||"string"!=typeof t||t.search(/id=(["'])scsControllerBody\1/g)>=0)throw"Invalid response received while fetching page data.";var s=this.parseJson(t);this.data.pageModel=this.getEffectivePageModel(s),this.data.pageLayout=this.data.pageModel.properties.pageLayout,this.data.mobileLayout=this.data.pageModel.properties.mobileLayout}catch(e){var r=this.getErrorPageId();if(this.data.isRenderingErrorPage||null===r)throw e;return this.data.isRenderingErrorPage=!0,this.data.placeholderContent=null,this.data.pageId=r,void this.fetchPageData()}this.getPageLayout(SCS.getDeviceInfo().isMobile&&this.data.mobileLayout||this.data.pageLayout)},SCS.showErrorPage=function(e){var t=SCS.cacheKeys.theme?SCS.cacheKeys.theme+"/":"",s=SCS.sitePrefix+t+"_themesdelivery/"+encodeURIComponent(this.data.siteInfo.properties.themeName)+"/responsepages/"+encodeURIComponent(e)+".html";SCS.performance.startTimer("GET layout"),this.callService(s,this.processPageLayout)},SCS.redirectToUrl=function(e){window.location.replace?window.location.replace(e):window.location.href=e},SCS.getEffectivePageModel=function(e){var t=e&&e.base?e.base:{},s={};return s.properties=t.properties||{},s.slots=t.slots||{},s.componentInstances=t.componentInstances||{},s},SCS.getEffectiveSlotReuseModel=function(e){return e&&"object"==typeof e&&!Array.isArray(e)?e:{}},SCS.getErrorPageId=function(){var e=null;return this.data.siteInfo&&this.data.siteInfo.properties&&this.data.navMap&&"number"==typeof this.data.siteInfo.properties.errorPage&&this.data.navMap[this.data.siteInfo.properties.errorPage]&&(e=this.data.siteInfo.properties.errorPage),e},SCS.getDeviceInfo=SCS.getDeviceInfo||function(e){return e=e||navigator.userAgent,{isMobile:/Mobi|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)&&!/iPad/i.test(e),isIOS:/iPad|iPhone|iPod/i.test(e)&&!window.MSStream}},SCS.performance.startTimer=function(e){var t=SCS.performance.now(),s=SCS.performance.timers[e]||{};s.start=t,SCS.performance.timers[e]=s},SCS.performance.stopTimer=function(e){var t=SCS.performance.now(),s=SCS.performance.timers[e]||{};s.end=t,SCS.performance.timers[e]=s},SCS.performance.now=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},SCS.performance.startTimer("TOTAL"),SCS.performance.startTimer("CONTROLLER"),SCS.initRendering();